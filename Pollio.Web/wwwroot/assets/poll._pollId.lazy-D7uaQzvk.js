import{b as d,d as p,h as c,e as m,j as e,B as h}from"./index-YZ1IrW_h.js";import{u as j,a as x,L as f,b as g,c as y}from"./useInvalidatePolls-CJ_bKH7-.js";import{u as P,M as v}from"./card-Cnfbudv5.js";import{u as D,T as F}from"./trash-2-B5iLURdv.js";function E(){const{connection:t}=d("/r/pollhub"),s=p(),r=D(),{mutate:l,isPending:a,error:i}=P({mutationFn:async n=>{await fetch(`/api/poll/${n}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n})})},onSuccess:()=>{s.invalidateQueries({queryKey:["polls"]}),t==null||t.invoke("SendPoll"),r({from:"/poll/$pollId",to:"/"})}});return{deletePoll:l,isDeleting:a,DeletePollError:i}}function N(t){const{user:s}=c(),{data:r,error:l,isPending:a}=j({queryKey:["polls",t],queryFn:async()=>{const n=await(await fetch(`/api/poll/${t}`)).json();return n.options=n.options.map(o=>!s||!s.id?o:o.allVotes.includes(s.id)?{...o,selected:!0}:o),n}});return{poll:r,error:l,isPending:a}}const b=m("/poll/$pollId")({component:w});function w(){const{pollId:t}=b.useParams(),{poll:s,isPending:r,error:l}=N(t),{deletePoll:a,isDeleting:i}=E(),{user:n}=c(),o=(s==null?void 0:s.user.id)===(n==null?void 0:n.id);x();const u=()=>{confirm("Are you sure you want to delete this poll?")&&a(+t)};return e.jsx(v,{children:r?e.jsx(f,{}):l?e.jsxs("p",{children:["Error: ",l.message]}):s?e.jsxs(e.Fragment,{children:[e.jsx(g,{poll:s}),o&&e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(h,{disabled:i,onClick:u,variant:"destructive",className:"flex items-center gap-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"animate-spin"}),e.jsx("span",{children:"Deleting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{size:18}),e.jsx("span",{children:"Delete Poll"})]})})})]}):e.jsx("h1",{children:"No poll found."})})}export{b as Route};
