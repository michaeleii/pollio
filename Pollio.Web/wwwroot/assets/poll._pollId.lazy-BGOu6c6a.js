import{b as d,h as c,d as p,j as e,B as m}from"./index-lIHwyvmV.js";import{u as h,a as j,L as x,b as f,c as g}from"./useInvalidatePolls-CcluTASc.js";import{u as y,M as P}from"./card-BJopRQF5.js";import{u as D,T as v}from"./trash-2-WNiatBpI.js";function F(){const n=d(),s=D(),{mutate:i,isPending:o,error:a}=y({mutationFn:async l=>{await fetch(`/api/poll/${l}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:l})})},onSuccess:()=>{n.invalidateQueries({queryKey:["polls"]}),s({from:"/poll/$pollId",to:"/"})}});return{deletePoll:i,isDeleting:o,DeletePollError:a}}function E(n){const{user:s}=c(),{data:i,error:o,isPending:a}=h({queryKey:["polls",n],queryFn:async()=>{const t=await(await fetch(`/api/poll/${n}`)).json();return t.options=t.options.map(r=>!s||!s.id?r:r.allVotes.includes(s.id)?{...r,selected:!0}:r),t}});return{poll:i,error:o,isPending:a}}const N=p("/poll/$pollId")({component:w});function w(){const{pollId:n}=N.useParams(),{poll:s,isPending:i,error:o}=E(n),{deletePoll:a,isDeleting:l}=F(),{user:t}=c(),r=(s==null?void 0:s.user.id)===(t==null?void 0:t.id);j();const u=()=>{confirm("Are you sure you want to delete this poll?")&&a(+n)};return e.jsx(P,{children:i?e.jsx(x,{}):o?e.jsxs("p",{children:["Error: ",o.message]}):s?e.jsxs(e.Fragment,{children:[e.jsx(f,{poll:s}),r&&e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(m,{disabled:l,onClick:u,variant:"destructive",className:"flex items-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"animate-spin"}),e.jsx("span",{children:"Deleting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{size:18}),e.jsx("span",{children:"Delete Poll"})]})})})]}):e.jsx("h1",{children:"No poll found."})})}export{N as Route};
