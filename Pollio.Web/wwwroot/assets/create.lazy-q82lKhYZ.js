import{c as P,r as j,j as s,a as w,R as D,u as R,b as I,d as N,h as q,B as g}from"./index-lIHwyvmV.js";import{u as _,M as T,C as k,a as A}from"./card-BJopRQF5.js";import{u as M,T as z}from"./trash-2-WNiatBpI.js";/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=P("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),x=j.forwardRef(({className:e,type:t,...n},o)=>s.jsx("input",{type:t,className:w("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:o,...n}));x.displayName="Input";var F={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const h=e=>{let t;const n=new Set,o=(u,l)=>{const d=typeof u=="function"?u(t):u;if(!Object.is(d,t)){const O=t;t=l??(typeof d!="object"||d===null)?d:Object.assign({},t,d),n.forEach(C=>C(t,O))}},i=()=>t,p={setState:o,getState:i,getInitialState:()=>a,subscribe:u=>(n.add(u),()=>n.delete(u)),destroy:()=>{(F?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},a=t=e(o,i,p);return p},L=e=>e?h(e):h;var E={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{useDebugValue:W}=D,{useSyncExternalStoreWithSelector:Q}=R;let v=!1;const U=e=>e;function V(e,t=U,n){(E?"production":void 0)!=="production"&&n&&!v&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),v=!0);const o=Q(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return W(o),o}const y=e=>{(E?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?L(e):e,n=(o,i)=>V(t,o,i);return Object.assign(n,t),n},J=e=>e?y(e):y,m=(()=>{let e=0;return()=>e++})(),S=[{id:m(),text:""},{id:m(),text:""}],c=J()(e=>({options:S,addOption:t=>e(n=>({options:[...n.options,{id:m(),text:t}]})),updateOption:(t,n)=>e(o=>({options:o.options.map(i=>i.id===t?{...i,text:n}:i)})),deleteOption:t=>e(n=>({options:n.options.filter(o=>o.id!==t)})),resetOptions:()=>e({options:S})}));function K(){const e=M(),t=I(),{mutate:n,isPending:o,error:i}=_({mutationFn:async r=>(await fetch("/api/poll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json(),onSuccess:()=>{t.invalidateQueries({queryKey:["polls"]}),e({to:"/"})}});return{createPoll:n,isPending:o,error:i}}const te=N("/create")({component:$});function $(){return s.jsx(T,{children:s.jsx(G,{})})}function G(){const{user:e,login:t}=q(),[n,o]=j.useState(""),i=c(a=>a.options),r=c(a=>a.resetOptions),{createPoll:f,isPending:b}=K();if(!e||!e.id){t();return}function p(a){if(a.preventDefault(),n.trim()===""||i.length<2||i.some(l=>l.text.trim()===""))return;if(!e||!e.id){t();return}const u={question:n,options:i.map(l=>l.text),userId:e.id};f(u),o(""),r()}return s.jsx(k,{children:s.jsx("form",{onSubmit:p,children:s.jsx(A,{children:s.jsxs("div",{className:"flex flex-col gap-4 pt-6",children:[s.jsx("div",{children:s.jsx(x,{required:!0,placeholder:"Enter your question here...",type:"text",id:"question",name:"question",value:n,onChange:a=>o(a.target.value),className:"w-full text-2xl font-semibold leading-none tracking-tight border-0 rounded-none pl-1 focus-visible:ring-0 focus-visible:border-b focus-visible:border-primary transition-colors"})}),s.jsx(H,{}),s.jsx(g,{disabled:b,className:"btn",children:b?"Creating Poll...":"Create Poll"})]})})})})}function H(){const e=c(o=>o.options),t=c(o=>o.addOption),n=e.length>2;return s.jsxs("div",{className:"grid gap-2 mb-4",children:[e.map(o=>s.jsx(X,{id:o.id,option:o.text,enableDelete:n},o.id)),s.jsxs(g,{type:"button",variant:"secondary",className:"flex items-center gap-1 mt-2",onClick:()=>t(""),children:[s.jsx(B,{size:16}),s.jsx("span",{children:"Add Option"})]})]})}function X({id:e,option:t,enableDelete:n}){const o=c(r=>r.updateOption),i=c(r=>r.deleteOption);return s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx(x,{required:!0,type:"text",placeholder:"Enter an option...",value:t,onChange:r=>o(e,r.target.value),className:"w-full border rounded-none p-5 h-full focus-visible:ring-0 focus-visible:border-b focus-visible:border-primary transition-colors"}),n&&s.jsx(g,{onClick:()=>i(e),type:"button",variant:"destructive",className:"h-full",children:s.jsx(z,{size:16})})]})}export{te as Route};
